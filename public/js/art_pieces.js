function showConfirmAlert(t,e){return Swal.fire({confirmButtonText:"Yes",cancelButtonText:"No",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,text:e,icon:"warning",width:"300px",customClass:{confirmButton:"btn bg-success swal-okay-button",cancelButton:"btn bg-danger swal-okay-button",title:"swal-title",content:"swal-subtitle"}})}function showSuccessAlert(t,e){Swal.fire({confirmButtonText:"Okay",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,html:e,icon:"success",width:"300px",customClass:{confirmButton:"btn bg-success swal-okay-button",title:"swal-title",content:"swal-subtitle"}})}function showErrorAlert(t,e){Swal.fire({confirmButtonText:"Okay",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,html:e,icon:"error",width:"300px",customClass:{confirmButton:"btn bg-danger swal-okay-button",title:"swal-title",content:"swal-subtitle"}})}function showInfoAlert(t,e){Swal.fire({confirmButtonText:"Okay",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,html:e,icon:"info",width:"300px",customClass:{confirmButton:"btn swal-okay-button",title:"swal-title",content:"swal-subtitle"}})}function showWarningAlert(t,e){Swal.fire({confirmButtonText:"Okay",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,html:e,icon:"warning",width:"300px",customClass:{confirmButton:"btn btn-warn swal-okay-button",title:"swal-title",content:"swal-subtitle-validation"}})}function showLoader(t,e){Swal.fire({allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,html:e,width:"300px",onBeforeOpen:()=>{Swal.showLoading()}})}function showHttpErrorAlert(t){0==t.status?showErrorAlert("Error","Check your internet connection and try again"):500==t.status?showErrorAlert("Internal server error",t.responseJSON.message?t.responseJSON.message:t.responseJSON):404==t.status?showErrorAlert("Error 404","The data you requested was not found"):showErrorAlert("Unknown Error","Oopps... Something went wrong")}function showValidationErrorAlert(t,e){e=e.responseJSON;let a="<ul>";for(const n of t)if(void 0!==e[n])for(const t of e[n])a+=`<li>${t}</li>`;showWarningAlert("Warning",a+="</ul>")}function showModal(t,e,a="350px"){Swal.fire({showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,title:t,html:e,width:a,customClass:{title:"swal-title",content:"swal-subtitle"}})}$(document).ready(function(){var t=null;function e(t,e){$("#description").css("height",$("#description")[0].scrollHeight+"px"),$(".sidepanel").removeClass("sidepanel-hidden").addClass("sidepanel-shown").attr("id",t),$("#title").html(e),$("#overlay").removeAttr("hidden"),$("html").css("overflow","hidden")}$(".add_new_btn").click(function(){e("piece_add_form","Add new art piece")}),$(document).on("change","#_image_input",function(t){const e=new Compress,a=document.getElementById("_image"),n=[...t.target.files];e.compress(n,{size:4,quality:.75,maxWidth:1920,maxHeight:1920,resize:!0}).then(t=>{const e=t[0];a.src=`${e.prefix}${e.data}`;const{endSizeInMb:n,initialSizeInMb:i,iterations:s,sizeReducedInPercent:o,elapsedTimeInSeconds:l,alt:r}=e})}),$(document).on("submit","#piece_add_form",function(t){t.preventDefault();let e=$(this).serializeArray();/\S/.test($("#_image_input").val())&&e.push({name:"image",value:$("#_image").attr("src")}),showLoader("Saving","Please wait..."),ajaxCall("/backend/art-pieces",e,"POST").done(t=>{showSuccessAlert("Success","Successfully added new art piece"),$("#art_pieces").append(`\n\t\t\t\t<div class="border shadow p-4 row m-0 mb-4 bg-light parent-${t.id}">\n\t\t\t\t\t<div class="col-md-2 content-img view-img piece-image mb-2" src="/${t.image}" style="background-image: url('/${t.image}');"></div>\n\t\t\t\t\t<div class="col-md-10">\n\t\t\t\t\t\t<span style="float: right !important; font-size: 1.2em !important; cursor: pointer">\n\t\t\t\t\t\t\t<i class="fa fa-pencil text-gold text-gold-hover edit-btn" value="${t.id}" title="edit"></i>\n\t\t\t\t\t\t\t&nbsp;&nbsp;\n\t\t\t\t\t\t\t<i class="fa fa-trash text-gold text-gold-hover delete-btn" value="${t.id}" title="delete"></i>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span style="font-size: 1.3em;" class="text-gold piece-title">${t.title}</span>\n\t\t\t\t\t\t&nbsp;&nbsp;<span class="badge bgac-red">${1==t.sold?"Reserved":""}</span>\n\t\t\t\t\t\t<br>\n\t\t\t\t\t\t<span class="smaller">\n\t\t\t\t\t\t\tby\n\t\t\t\t\t\t\t<span class="piece-artist">${t.artist} (${t.category_name})</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t<span class="piece-description">${t.description}</span>\n\t\t\t\t\t\t<a href="#" class="text-primary smaller see_more">See More</a>\n\t\t\t\t\t\t<br><br>\n\t\t\t\t\t\t<p class="smaller text-gold">\n\t\t\t\t\t\t\tLast updated by:<br>\n\t\t\t\t\t\t\t<span class="piece-updated">\n\t\t\t\t\t\t\t\t${t.updated_by}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`),$("#close_panel").click()}).fail(t=>{showHttpErrorAlert(t)})}),$(document).on("click",".view-img",function(){showModal("",`\t\t\n\t\t\t<span style="float: right !important; font-size: 1.5em !important; cursor: pointer" onclick="Swal.close();"><i class="fa fa-times"></i></span>\n\t\t\t<br><br>\n\t\t\t<img src="${$(this).attr("src")}" width="100%">\n\t\t`,500)}),$(document).on("click",".edit-btn",function(){t=$(this).attr("value"),showLoader("Loading","Please wait..."),$.get(`/backend/art-pieces/${t}`,function(t){Swal.close(),$("#_image").attr("src",`/${t.image}`),$("#art_piece_title").val(t.title),$("#artist_id").val(t.artist?t.artist.id:""),$("#artist_name").val(t.artist?t.artist.name:""),$("#category").val(t.category),$("#description").val(t.description),$("#specification").val(t.specification),$("#sold").prop("checked",1==t.sold),e("piece_edit_form","Edit art piece")}).fail(t=>{showHttpErrorAlert(t)})}),$(document).on("submit","#piece_edit_form",function(e){e.preventDefault();let a=$(this).serializeArray();/\S/.test($("#_image_input").val())&&a.push({name:"image",value:$("#_image").attr("src")}),showLoader("Updating","Please wait..."),ajaxCall(`/backend/art-pieces/${t}`,a,"PUT").done(t=>{showSuccessAlert("Success","Art piece detail was successfully updated!"),$(`.parent-${t.id}`).find(".piece-image").attr("src",`/${t.image}`),$(`.parent-${t.id}`).find(".piece-image").css("background-image",`url('/${t.image}')`),$(`.parent-${t.id}`).find(".piece-title").html(t.title),$(`.parent-${t.id}`).find(".piece-artist").html(`${t.artist}  (${t.category_name})`),$(`.parent-${t.id}`).find(".piece-description").html(t.description),$(`.parent-${t.id}`).find(".piece-updated").html(t.updated_by),$(`.parent-${t.id}`).find(".badge").html(`${1==t.sold?"Reserved":""}`),$("#close_panel").click()}).fail(t=>{showHttpErrorAlert(t)})}),$(document).on("click",".delete-btn",function(){parent=$(this).parent().parent().parent(),t=$(this).attr("value"),showConfirmAlert("Warning","Are you sure to delete this art piece?").then(e=>{e.value&&(showLoader("Deleting","Please wait..."),ajaxCall(`/backend/art-pieces/${t}`,{_token:_token},"DELETE").done(t=>{showSuccessAlert("Success","Art piece was successfully deleted"),parent.fadeOut("fast",function(){$(this).remove()})}).fail(t=>{showHttpErrorAlert(t)}))})}),$(document).on("click","#upload-btn",function(){$("#_image_input").click()}),$("#artist_name").autocomplete({minLength:0,source:function(t,e){$.get(`/search/artists?keyword=${$("#artist_name").val()}`,function(t){e($.map(t.data,function(t){return{value:t.name,id:t.id}}))})},select:function(t,e){$("#artist_id").val(e.item.id),$("#artist_name").blur()},change:function(){/\S/.test($("#artist_name").val())&&/\S/.test($("#artist_id").val())||($("#artist_id").val(""),$("#artist_name").val(""))}}).focus(function(){$(this).data("uiAutocomplete").search($(this).val())}),$(document).on("click",".see_more",function(){t=$(this).attr("value"),showLoader("Loading","Please wait..."),$.get(`/backend/art-pieces/${t}`,function(t){showModal("",`\t\t\n\t\t\t\t<span style="float: right !important; font-size: 1.5em !important; cursor: pointer" onclick="Swal.close();"><i class="fa fa-times"></i></span>\n\t\t\t\t<br><br>\n\t\t\t\t<h4 class="text-gold">${t.title}</h4>\n\t\t\t\tby ${t.artist.name}\n\t\t\t\t<hr>\n\t\t\t\t${t.description}<br><br>\n\t\t\t\t<div style="text-align: left !important;">\n\t\t\t\t\t<label><b>Specification</b></label>\n\t\t\t\t\t<p style="white-space: pre-wrap;">${t.specification}</p>\n\t\t\t\t</div>\n\t\t\t`,600)}).fail(t=>{showHttpErrorAlert(t)})}),$("#close_panel").click(function(){$(".sidepanel").removeClass("sidepanel-shown").addClass("sidepanel-hidden"),$("#overlay").attr("hidden",""),$("html").css("overflow","auto"),setTimeout(()=>{$(".art_piece_form")[0].reset(),$("#_image").attr("src","/img/no-image.png")},600)})});var _token=$('meta[name="csrf-token"]').attr("content");function findObjectBySubKey(t,e,a,n){for(var i=0;i<t.length;i++)if(t[i][e][a]==n)return i;return null}function multiArraySort(t,e){t.sort(function(t,a){const n=t[e],i=a[e];let s=0;return n>i?s=-1:n<i&&(s=1),s})}function ajaxCall(t,e,a){return $.ajax({url:t,data:e,type:a})}function ajaxCall2(t,e,a){return $.ajax({url:t,data:e,type:a,cache:!1,contentType:!1,processData:!1})}function getTime(){date=new Date;var t=date.getHours(),e=date.getMinutes();return(t=t<10?"0"+t:t)+":"+(e=e<10?"0"+e:e)}function getDate(){let t=new Date;return`${t.getFullYear()}-${t.getMonth()<10?"0"+t.getMonth():t.getMonth()}-${t.getDate()<10?"0"+t.getDate():t.getDate()}`}$(function(){$('[data-toggle="tooltip"]').tooltip()});
